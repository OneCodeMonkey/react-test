<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>选则最佳封面</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .container{
            border: 2px solid #dcdcdc;
            width: 95%;
            padding: 1px;
        }
        .media-object{
            width: 120px;
            height: 120px;
        }
        .media-video{
            width: 100%;
            height: 100%;
            margin: 5px 5px;
        }
        .media-heading{
            text-align: center;
        }

        #video_1{
            height: 4%;
        }
        #cover-groups{
            margin-top: 40px;
            height: 55%;
            margin-bottom: 5px;
        }
        .cover-group{
            width: 100%;
        }
        .vertical-cover-list-item{
            width: 100%;
            height: 100%;
            list-style-type: none;
            margin-bottom: 2px;
        }
        .cover-img{
            width: 100%;
            height: 100%;
        }
        #infoBoard{
        }

        /* img 点击放大 */
        .overlay {
            background-color: #000;
            opacity: 1.0;
            filter: alpha(opacity=100);
            position: fixed;
            top: 0;
            left: 0;
            margin-left: 5%;
            margin-top: 2%;
            width: 90%;
            height: 90%;
            z-index: 12;
            overflow: auto;
        }
        .overlayimg {
            position: absolute;
            z-index: 11;
            width: 99%;
            height: auto;
        }
        /* img 点击放大 */

        #answer{
            margin-left: 7.2%;
        }
        .radio-inline{
            width: 18.5%;
        }
        .form-group{
            margin-bottom: 50px;
        }
        #prev, #next{
            width: 30%;
            margin: 5px 5%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row" id="video_1">
            <div class="col-md-5">
                <div class="media">
                    <div class="media-top">
                        <a href="#">
<!--                            <img class="media-object" src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_00.jpg" alt="195359_00">-->
                            <video class="media-video" src="http://eyepetizer-videos.oss-cn-beijing.aliyuncs.com/d155747de9290d83dacce27711fd29f3_1280x720.mp4" alt="video-195359" controls autoplay>0</video>
                        </a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">原视频_195359</h4>
                    </div>
                </div>
            </div>

            <div class="col-md-1"></div>

            <div class="col-md-5" id="infoBoard">
                <h3>当前标记： <span id="nowID">56</span>&nbsp;/&nbsp;<span>100</span></h3>
                <h3 id="cookieInfo">提示信息：给当前的视频，选一组您认为最佳的封面。</h3>
<!--                <h4></h4>-->
            </div>
        </div>
        <div class="row" id="cover-groups">
            <div class="col-md-2" id="original">
                <div class="cover-group">
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="original_00"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_00.jpg"
                             alt="195359_00">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="original_01"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_01.jpg"
                             alt="195359_00">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="original_02"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_02.jpg"
                             alt="195359_00">
                    </div>
                </div>
            </div>
            <div class="col-md-2" id="mobilenet">
                <div class="cover-group">
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="mobilenet_00"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_01.jpg"
                             alt="195359_01">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="mobilenet_01"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_02.jpg"
                             alt="195359_02">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="mobilenet_02"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_03.jpg"
                             alt="195359_03">
                    </div>
                </div>
            </div>
            <div class="col-md-2" id="nasnet">
                <div class="cover-group">
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="nasnet_00"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_02.jpg"
                             alt="195359_02">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="nasnet_01"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_03.jpg"
                             alt="195359_03">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="nasnet_02"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_04.jpg"
                             alt="195359_04">
                    </div>
                </div>
            </div>
            <div class="col-md-2" id="resnet">
                <div class="cover-group">
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="resnet_00"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_03.jpg"
                             alt="195359_03">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="resnet_01"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_04.jpg"
                             alt="195359_04">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="resnet_02"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_00.jpg"
                             alt="195359_00">
                    </div>
                </div>
            </div>
            <div class="col-md-2" id="technical_score">
                <div class="cover-group">
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="technical_score_00"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_04.jpg"
                             alt="195359_04">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="technical_score_01"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_00.jpg"
                             alt="195359_00">
                    </div>
                    <div class="vertical-cover-list-item">
                        <img class="cover-img" id="technical_score_02"
                             src="https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/195359_01.jpg"
                             alt="195359_01">
                    </div>
                </div>
            </div>
            <div class="col-md-2">

            </div>
        </div>
        <div class="row" id="answer-radio-groups">
            <div class="col-md-10" id="answer">
                <form role="form" id="form01">
                    <div class="form-group">
                        <label class="radio-inline">
                            <input type="radio"  value="original" name="algo">
                        </label>
                        <label class="radio-inline">
                            <input type="radio"  value="mobilenet" name="algo">
                        </label>
                        <label class="radio-inline">
                            <input type="radio"  value="nasnet" name="algo">
                        </label>
                        <label class="radio-inline">
                            <input type="radio"  value="resnet" name="algo">
                        </label>
                        <label class="radio-inline">
                            <input type="radio"  value="technical_score" name="algo">
                        </label>
                    </div>

                    <button class="btn btn-default" type="button" id="prev">重选上一个</button>
                    <button class="btn btn-default" type="submit" id="next">下一个</button>

                </form>
            </div>
        </div>
    </div>


    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

    <!-- init-->
    <script>
        // 读取题目信息 start
        var configure_json = $.ajax({url: "videoid-url.json",async: false}).responseText;
        var configure_json_val = $.parseJSON(configure_json);

        var questionList = [];
        for (let key in configure_json_val) {
            let temp = [];
            temp["video_id"] = key;
            temp["url"] = configure_json_val[key];

            questionList.push(temp);
        }

        // mobilenet
        var mobilenet_json = $.ajax({url: "mobilenet.json",async: false}).responseText;
        var mobilenet_json_val = $.parseJSON(mobilenet_json);
        var mobilenetList = [];
        for (let key in mobilenet_json_val) {
            let temp = [];
            temp[0] = mobilenet_json_val[key][0];
            temp[1] = mobilenet_json_val[key][1];
            temp[2] = mobilenet_json_val[key][2];
            mobilenetList.push(temp);
        }
        // nasnet
        var nasnet_json = $.ajax({url: "nasnet.json",async: false}).responseText;
        var nasnet_json_val = $.parseJSON(nasnet_json);
        var nasnetList = [];
        for (let key in nasnet_json_val) {
            let temp = [];
            temp[0] = nasnet_json_val[key][0];
            temp[1] = nasnet_json_val[key][1];
            temp[2] = nasnet_json_val[key][2];
            nasnetList.push(temp);
        }
        // resnet
        var resnet_json = $.ajax({url: "resnet.json",async: false}).responseText;
        var resnet_json_val = $.parseJSON(resnet_json);
        var resnetList = [];
        for (let key in resnet_json_val) {
            let temp = [];
            temp[0] = resnet_json_val[key][0];
            temp[1] = resnet_json_val[key][1];
            temp[2] = resnet_json_val[key][2];
            resnetList.push(temp);
        }
        // technical_score
        var technical_score_json = $.ajax({url: "technical_score.json",async: false}).responseText;
        var technical_score_json_val = $.parseJSON(technical_score_json);
        var technical_scoreList = [];
        for (let key in technical_score_json_val) {
            let temp = [];
            temp[0] = technical_score_json_val[key][0];
            temp[1] = technical_score_json_val[key][1];
            temp[2] = technical_score_json_val[key][2];
            technical_scoreList.push(temp);
        }
        // 读取题目信息 end
    </script>

    <!-- main -->
    <script>
        const imgUrlPrefix = "https://resource-thefair-bj.oss-cn-beijing.aliyuncs.com/weiboStatistics/video_kaiyan_compare_cover_algorithms/500_most_played_video_export_frames/";
        const alternatives = ["original", "mobilenet", "nasnet", "resnet", "technical_score"];
        const apiHost = "http://127.0.0.1:9501";

        // 生成随机ID,方便刷新页面时，也能继续标记
        function genID(length) {
            return Number(Math.random().toString().substr(3, length) + Date.now()).toString(36);
        }

        function getCookieVariable(variableName) {
            var cookieArray = document.cookie;
            var arr = cookieArray.split(";");

            for (var i = 0; i < arr.length; i++) {
                var arr1 = arr[i].split("=");
                if (arr1[0].trim() == variableName) {
                    return arr1[1];
                }
            }

            return "";
        }

        function setCookieVariable(name, value) {
            var exp = new Date();
            exp.setTime(exp.getTime() + 10*24*60*60*1000);  // 设置过期时间

            document.cookie = name + "=" + value + ";expires=" + exp.toGMTString();
        }

        if (getCookieVariable("video_tag_app_name") === "") {
            setCookieVariable("video_tag_app_name", genID(4));
        }

        var cookieArray = document.cookie;  //获取cookie存储字符串
        console.log(cookieArray);

        var cookieInfo = document.getElementById("cookieInfo");
        // cookieInfo.innerHTML=cookieArray;

        var nowIdTitle = document.getElementById("nowID");
        nowIdTitle.innerHTML = getCookieVariable("question_id");

        // 切换页面内容
        function setPage(questionId) {
            // 提示题目序号
            nowIdTitle.innerHTML = getCookieVariable("question_id");

            // 视频信息
            $(".media-video").attr("src", questionList[questionId]["url"]);
            $(".media-video").attr("alt", "video-" + questionList[questionId]["video_id"]);
            $(".media-heading").text("原视频_" + questionList[questionId]["video_id"]);

            // 图片信息
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 3; j++) {
                    // 对应算法的图片的 index
                    switch (i) {
                        case 0:
                            var imgIndex = j;
                            break;
                        case 1:
                            var imgIndex = mobilenetList[questionId][j];
                            break;
                        case 2:
                            var imgIndex = nasnetList[questionId][j];
                            break;
                        case 3:
                            var imgIndex = resnetList[questionId][j];
                            break;
                        case 4:
                            var imgIndex = technical_scoreList[questionId][j];
                            break;
                    }

                    $("#" + alternatives[i] + "_0" + j).attr("src", imgUrlPrefix + questionList[questionId]["video_id"] + "_0" + imgIndex + ".jpg");
                    $("#" + alternatives[i] + "_0" + j).attr("alt", questionList[questionId]["video_id"] + "_0" + imgIndex);
                }
            }
        }

        if (getCookieVariable("question_id") === "") {
            setCookieVariable("question_id", 1);
            setPage(1);
        } else {
            var nowQuestionId = getCookieVariable("question_id");
            setPage(nowQuestionId);
        }
        console.log(cookieArray);

        // 下一题
        function btnNext() {
            var nowQuestionId = getCookieVariable("question_id");
            var nextQuestionId = parseInt(nowQuestionId) + 1;
            console.log("next question id:" + nextQuestionId);
            setCookieVariable("question_id", nextQuestionId);

            // 设置页面
            setPage(nextQuestionId);

            var chosenAlgo = document.getElementById("form01").algo.value;
            console.log(chosenAlgo);

            // 提交服务器数据
            if (!chosenAlgo.empty()) {
                var username = getCookieVariable("video_tag_app_name");
                var videoId = questionList[nextQuestionId]["video_id"];

                $.ajax({
                    url: apiHost,
                    data: {username: username, video_id: videoId, algo: chosenAlgo},
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                        console.log("api success with return:" + data);
                    }
                });
            }
        }

        // 上一题
        function btnPrev() {
            var nowQuestionId = getCookieVariable("question_id");
            var prevQuestionId = parseInt(nowQuestionId) - 1;
            console.log("prev question id:" + prevQuestionId);
            setCookieVariable("question_id", prevQuestionId);

            // 设置页面
            setPage(prevQuestionId);
        }

        $("#prev").click(function () {
            btnPrev();
        });
        $("#next").click(function () {
            btnNext();
        });

    </script>

    <!-- 给img元素添加点击放大事件 -->
    <script>
        function expandPhoto() {
            var overlay = document.createElement("div");
            overlay.setAttribute("id", "overlay");
            overlay.setAttribute("class", "overlay");
            document.body.appendChild(overlay);

            var img = document.createElement("img");
            img.setAttribute("id", "expand")
            img.setAttribute("class", "overlayimg");
            img.src = this.getAttribute("src");
            document.getElementById("overlay").appendChild(img);

            img.onclick = restore;
        }

        function restore() {
            document.body.removeChild(document.getElementById("overlay"));
            document.body.removeChild(document.getElementById("expand"));
        }

        function addExpand() {
            var imgs = document.getElementsByTagName("img");
            imgs[0].focus();
            for (var i = 0; i < imgs.length; i++) {
                imgs[i].onclick = expandPhoto;
                imgs[i].onkeydown = expandPhoto;
            }
        }

        addExpand();
    </script>
</body>
</html>